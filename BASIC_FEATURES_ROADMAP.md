# åŸºæœ¬æ©Ÿèƒ½å®Ÿè£…ãƒ­ãƒ¼ãƒ‰ãƒãƒƒãƒ—

## ğŸ¯ ç›®çš„

Task 0-2ï¼ˆVercel ãƒ‡ãƒ—ãƒ­ã‚¤ï¼‰ã¨ Task 0-3ï¼ˆãƒ‰ãƒ¡ã‚¤ãƒ³æ¥ç¶šï¼‰ã®åˆé–“ã«ã€åŸºæœ¬æ©Ÿèƒ½ã®å®Ÿè£…ã‚’é€²ã‚ã‚‹ã€‚

---

## ğŸ“‹ å®Ÿè£…å„ªå…ˆé †ä½

### Phase 1ï¼šãƒ‡ãƒ¼ã‚¿åŸºç›¤ï¼ˆWeek 1-2ï¼‰
| æ©Ÿèƒ½ | å„ªå…ˆåº¦ | æ‰€è¦æ™‚é–“ | ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ |
|------|--------|---------|-----------|
| ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹è¨­è¨ˆ | P0 | 1 æ—¥ | â³ å¾…æ©Ÿä¸­ |
| Prisma ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ— | P0 | 0.5 æ—¥ | â³ å¾…æ©Ÿä¸­ |
| åŸºæœ¬ãƒ¢ãƒ‡ãƒ«å®Ÿè£… | P0 | 1 æ—¥ | â³ å¾…æ©Ÿä¸­ |
| ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ | P0 | 0.5 æ—¥ | â³ å¾…æ©Ÿä¸­ |

### Phase 2ï¼šCRM åŸºæœ¬æ©Ÿèƒ½ï¼ˆWeek 2-3ï¼‰
| æ©Ÿèƒ½ | å„ªå…ˆåº¦ | æ‰€è¦æ™‚é–“ | ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ |
|------|--------|---------|-----------|
| CRM CRUD API | P0 | 1 æ—¥ | â³ å¾…æ©Ÿä¸­ |
| CRM æ¤œç´¢ API | P0 | 0.5 æ—¥ | â³ å¾…æ©Ÿä¸­ |
| CRM UIï¼ˆä¸€è¦§ï¼‰ | P0 | 1 æ—¥ | â³ å¾…æ©Ÿä¸­ |
| CRM UIï¼ˆè©³ç´°ï¼‰ | P0 | 0.5 æ—¥ | â³ å¾…æ©Ÿä¸­ |
| CRM UIï¼ˆæ–°è¦ãƒ»ç·¨é›†ï¼‰ | P0 | 1 æ—¥ | â³ å¾…æ©Ÿä¸­ |

### Phase 3ï¼šèªè¨¼æ©Ÿèƒ½ï¼ˆWeek 3-4ï¼‰
| æ©Ÿèƒ½ | å„ªå…ˆåº¦ | æ‰€è¦æ™‚é–“ | ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ |
|------|--------|---------|-----------|
| NextAuth.js ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ— | P1 | 0.5 æ—¥ | â³ å¾…æ©Ÿä¸­ |
| ãƒ­ã‚°ã‚¤ãƒ³æ©Ÿèƒ½ | P1 | 1 æ—¥ | â³ å¾…æ©Ÿä¸­ |
| ãƒ¦ãƒ¼ã‚¶ãƒ¼ç®¡ç† | P1 | 1 æ—¥ | â³ å¾…æ©Ÿä¸­ |
| æ¨©é™ç®¡ç†ï¼ˆRBACï¼‰ | P2 | 1 æ—¥ | â³ å¾…æ©Ÿä¸­ |

### Phase 4ï¼šKPI ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ï¼ˆWeek 4-6ï¼‰
| æ©Ÿèƒ½ | å„ªå…ˆåº¦ | æ‰€è¦æ™‚é–“ | ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ |
|------|--------|---------|-----------|
| KPI ãƒ‡ãƒ¼ã‚¿ãƒ¢ãƒ‡ãƒ« | P1 | 0.5 æ—¥ | â³ å¾…æ©Ÿä¸­ |
| è³ƒè²¸ KPI API | P1 | 1 æ—¥ | â³ å¾…æ©Ÿä¸­ |
| å£²è²· KPI API | P1 | 1 æ—¥ | â³ å¾…æ©Ÿä¸­ |
| æ°‘æ³Š KPI API | P2 | 1 æ—¥ | â³ å¾…æ©Ÿä¸­ |
| KPI ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ UI | P1 | 2 æ—¥ | â³ å¾…æ©Ÿä¸­ |

---

## ğŸš€ Phase 1ï¼šãƒ‡ãƒ¼ã‚¿åŸºç›¤ï¼ˆæœ€å„ªå…ˆï¼‰

### 1-1. ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹è¨­è¨ˆ

#### ã‚¹ã‚­ãƒ¼ãƒè¨­è¨ˆ
```prisma
// prisma/schema.prisma

// é¡§å®¢ãƒ†ãƒ¼ãƒ–ãƒ«
model Customer {
  id           String   @id @default(cuid())
  name         String
  nameKana     String?
  email        String   @unique
  phone        String?
  address      String?
  notes        String?
  type         String   // 'rent', 'sale', 'minpaku'
  status       String   @default("active") // 'active', 'inactive'
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt
  
  // ãƒªãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³
  inquiries    Inquiry[]
  properties   PropertyInterest[]
}

// ç‰©ä»¶ãƒ†ãƒ¼ãƒ–ãƒ«
model Property {
  id           String   @id @default(cuid())
  title        String
  type         String   // 'rent', 'sale', 'minpaku'
  price        Float
  address      String
  area         Float?
  rooms        String?
  imageUrls    String[] // JSON array
  description  String?
  status       String   @default("available") // 'available', 'rented', 'sold'
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt
  
  // ãƒªãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³
  interests    PropertyInterest[]
  inquiries    Inquiry[]
}

// å•åˆã›ãƒ†ãƒ¼ãƒ–ãƒ«
model Inquiry {
  id           String   @id @default(cuid())
  customerId   String
  propertyId   String?
  type         String   // 'viewing', 'inquiry', 'application'
  message      String
  status       String   @default("pending") // 'pending', 'processing', 'completed'
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt
  
  // ãƒªãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³
  customer     Customer @relation(fields: [customerId], references: [id])
  property     Property? @relation(fields: [propertyId], references: [id])
}

// ç‰©ä»¶èˆˆå‘³ãƒ†ãƒ¼ãƒ–ãƒ«ï¼ˆå¤šå¯¾å¤šï¼‰
model PropertyInterest {
  id           String   @id @default(cuid())
  customerId   String
  propertyId   String
  createdAt    DateTime @default(now())
  
  // ãƒªãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³
  customer     Customer @relation(fields: [customerId], references: [id])
  property     Property @relation(fields: [propertyId], references: [id])
  
  @@unique([customerId, propertyId])
}

// KPI ãƒ‡ãƒ¼ã‚¿ãƒ†ãƒ¼ãƒ–ãƒ«
model KPI {
  id           String   @id @default(cuid())
  type         String   // 'rent', 'sale', 'minpaku'
  metric       String   // 'inquiry_count', 'viewing_count', etc.
  value        Float
  date         DateTime
  createdAt    DateTime @default(now())
  
  @@index([type, date])
}
```

#### å®Ÿè£…æ‰‹é †
1. PostgreSQL ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚’æº–å‚™
2. Prisma ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ãƒ»è¨­å®š
3. ã‚¹ã‚­ãƒ¼ãƒã‚’å®šç¾©
4. ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚’å®Ÿè¡Œ
5. Seed ãƒ‡ãƒ¼ã‚¿ã‚’æŠ•å…¥

---

### 1-2. Prisma ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—

#### ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
```bash
cd /home/user/webapp
npm install prisma @prisma/client
npx prisma init
```

#### è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«
```env
# .env
DATABASE_URL="postgresql://user:password@localhost:5432/kanae?schema=public"
```

#### ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³
```bash
# ã‚¹ã‚­ãƒ¼ãƒã‚’ä½œæˆ
npx prisma migrate dev --name init

# Prisma Client ã‚’ç”Ÿæˆ
npx prisma generate

# ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚’ãƒªã‚»ãƒƒãƒˆï¼ˆé–‹ç™ºæ™‚ã®ã¿ï¼‰
npx prisma migrate reset
```

---

## ğŸ”§ Phase 2ï¼šCRM åŸºæœ¬æ©Ÿèƒ½

### 2-1. CRM CRUD API

#### ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆè¨­è¨ˆ
```typescript
// app/api/crm/customers/route.ts

// GET /api/crm/customers - é¡§å®¢ä¸€è¦§å–å¾—
export async function GET(request: Request) {
  const { searchParams } = new URL(request.url);
  const type = searchParams.get('type');
  const status = searchParams.get('status');
  const search = searchParams.get('search');
  
  // Prisma ã§ã‚¯ã‚¨ãƒª
  const customers = await prisma.customer.findMany({
    where: {
      ...(type && { type }),
      ...(status && { status }),
      ...(search && {
        OR: [
          { name: { contains: search } },
          { email: { contains: search } },
          { phone: { contains: search } }
        ]
      })
    },
    orderBy: { createdAt: 'desc' }
  });
  
  return Response.json({ customers });
}

// POST /api/crm/customers - é¡§å®¢æ–°è¦ç™»éŒ²
export async function POST(request: Request) {
  const data = await request.json();
  
  const customer = await prisma.customer.create({
    data: {
      name: data.name,
      email: data.email,
      // ...ãã®ä»–ã®ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰
    }
  });
  
  return Response.json({ customer }, { status: 201 });
}
```

```typescript
// app/api/crm/customers/[id]/route.ts

// GET /api/crm/customers/:id - é¡§å®¢è©³ç´°å–å¾—
export async function GET(
  request: Request,
  { params }: { params: { id: string } }
) {
  const customer = await prisma.customer.findUnique({
    where: { id: params.id },
    include: {
      inquiries: true,
      properties: {
        include: {
          property: true
        }
      }
    }
  });
  
  if (!customer) {
    return Response.json({ error: 'Customer not found' }, { status: 404 });
  }
  
  return Response.json({ customer });
}

// PUT /api/crm/customers/:id - é¡§å®¢æ›´æ–°
export async function PUT(
  request: Request,
  { params }: { params: { id: string } }
) {
  const data = await request.json();
  
  const customer = await prisma.customer.update({
    where: { id: params.id },
    data
  });
  
  return Response.json({ customer });
}

// DELETE /api/crm/customers/:id - é¡§å®¢å‰Šé™¤
export async function DELETE(
  request: Request,
  { params }: { params: { id: string } }
) {
  await prisma.customer.delete({
    where: { id: params.id }
  });
  
  return Response.json({ success: true });
}
```

---

### 2-2. CRM UI å®Ÿè£…

#### é¡§å®¢ä¸€è¦§ãƒšãƒ¼ã‚¸
```typescript
// app/crm/customers/page.tsx

import { CustomerList } from '@/components/crm/CustomerList';
import { SearchBar } from '@/components/crm/SearchBar';

export default function CustomersPage() {
  return (
    <div className="container mx-auto py-8">
      <h1 className="text-3xl font-bold mb-6">é¡§å®¢ç®¡ç†</h1>
      
      <SearchBar />
      
      <CustomerList />
    </div>
  );
}
```

#### ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆæ§‹æˆ
```
components/crm/
â”œâ”€â”€ CustomerList.tsx       # é¡§å®¢ä¸€è¦§ãƒ†ãƒ¼ãƒ–ãƒ«
â”œâ”€â”€ CustomerCard.tsx       # é¡§å®¢ã‚«ãƒ¼ãƒ‰
â”œâ”€â”€ CustomerDetail.tsx     # é¡§å®¢è©³ç´°
â”œâ”€â”€ CustomerForm.tsx       # é¡§å®¢ãƒ•ã‚©ãƒ¼ãƒ ï¼ˆæ–°è¦ãƒ»ç·¨é›†ï¼‰
â”œâ”€â”€ SearchBar.tsx          # æ¤œç´¢ãƒãƒ¼
â””â”€â”€ FilterMenu.tsx         # ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ãƒ¡ãƒ‹ãƒ¥ãƒ¼
```

---

## ğŸ“Š å®Ÿè£…ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«

### Week 1ï¼šãƒ‡ãƒ¼ã‚¿åŸºç›¤
| æ—¥ | ã‚¿ã‚¹ã‚¯ | æˆæœç‰© |
|----|--------|--------|
| Day 1 | ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹è¨­è¨ˆ | `schema.prisma` |
| Day 2 | Prisma ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ— | ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³å®Œäº† |
| Day 3 | Seed ãƒ‡ãƒ¼ã‚¿ä½œæˆ | ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿æŠ•å…¥ |

### Week 2ï¼šCRM API
| æ—¥ | ã‚¿ã‚¹ã‚¯ | æˆæœç‰© |
|----|--------|--------|
| Day 4 | CRUD API å®Ÿè£… | `/api/crm/customers` |
| Day 5 | æ¤œç´¢ API å®Ÿè£… | æ¤œç´¢ãƒ»ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼æ©Ÿèƒ½ |

### Week 3ï¼šCRM UI
| æ—¥ | ã‚¿ã‚¹ã‚¯ | æˆæœç‰© |
|----|--------|--------|
| Day 6 | ä¸€è¦§ãƒšãƒ¼ã‚¸ | `app/crm/customers/page.tsx` |
| Day 7 | è©³ç´°ãƒšãƒ¼ã‚¸ | `app/crm/customers/[id]/page.tsx` |
| Day 8 | ãƒ•ã‚©ãƒ¼ãƒ å®Ÿè£… | æ–°è¦ãƒ»ç·¨é›†ãƒ•ã‚©ãƒ¼ãƒ  |

---

## ğŸ” å®Œäº†åŸºæº–

### Phase 1ï¼šãƒ‡ãƒ¼ã‚¿åŸºç›¤
- [ ] Prisma ãŒã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚Œã¦ã„ã‚‹
- [ ] `schema.prisma` ãŒå®šç¾©ã•ã‚Œã¦ã„ã‚‹
- [ ] ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ãŒå®Ÿè¡Œã•ã‚Œã¦ã„ã‚‹
- [ ] Seed ãƒ‡ãƒ¼ã‚¿ãŒæŠ•å…¥ã•ã‚Œã¦ã„ã‚‹
- [ ] Prisma Client ãŒå‹•ä½œã™ã‚‹

### Phase 2ï¼šCRM API
- [ ] é¡§å®¢ CRUD API ãŒå®Ÿè£…ã•ã‚Œã¦ã„ã‚‹
- [ ] æ¤œç´¢ãƒ»ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ API ãŒå‹•ä½œã™ã‚‹
- [ ] ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ãŒå®Ÿè£…ã•ã‚Œã¦ã„ã‚‹
- [ ] API ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆãŒä½œæˆã•ã‚Œã¦ã„ã‚‹

### Phase 3ï¼šCRM UI
- [ ] é¡§å®¢ä¸€è¦§ãƒšãƒ¼ã‚¸ãŒè¡¨ç¤ºã•ã‚Œã‚‹
- [ ] é¡§å®¢è©³ç´°ãƒšãƒ¼ã‚¸ãŒè¡¨ç¤ºã•ã‚Œã‚‹
- [ ] æ–°è¦ç™»éŒ²ãƒ•ã‚©ãƒ¼ãƒ ãŒå‹•ä½œã™ã‚‹
- [ ] ç·¨é›†ãƒ•ã‚©ãƒ¼ãƒ ãŒå‹•ä½œã™ã‚‹
- [ ] å‰Šé™¤æ©Ÿèƒ½ãŒå‹•ä½œã™ã‚‹

---

## ğŸ› ï¸ å¿…è¦ãªãƒ„ãƒ¼ãƒ«ãƒ»ãƒ©ã‚¤ãƒ–ãƒ©ãƒª

### ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹
```bash
npm install @prisma/client
npm install -D prisma
```

### UI ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
```bash
npm install @tanstack/react-table      # ãƒ†ãƒ¼ãƒ–ãƒ«
npm install react-hook-form            # ãƒ•ã‚©ãƒ¼ãƒ 
npm install zod                        # ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³
npm install date-fns                   # æ—¥ä»˜å‡¦ç†
```

### ãƒãƒ£ãƒ¼ãƒˆï¼ˆKPI ç”¨ï¼‰
```bash
npm install recharts                   # ãƒãƒ£ãƒ¼ãƒˆ
npm install @tremor/react              # ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ UI
```

---

## ğŸ“ æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—

1. **Task 0-2 å®Œäº†å¾Œ**ã€ã™ãã« Phase 1 ã‚’é–‹å§‹
2. ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹è¨­è¨ˆã‚’ç¢ºå®š
3. Prisma ã‚’ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—
4. CRM åŸºæœ¬æ©Ÿèƒ½ã®å®Ÿè£…ã«ç€æ‰‹

---

**ä½œæˆæ—¥**: 2026-01-12  
**ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹**: ãƒ­ãƒ¼ãƒ‰ãƒãƒƒãƒ—ä½œæˆå®Œäº†  
**é–‹å§‹äºˆå®š**: Task 0-2 å®Œäº†å¾Œ
